name: Release Docker Image

on:
  push:
    branches: [ dev ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      
    - name: Login to Docker
      run: docker login -u "${DOCKER_HUB_USERNAME}" -p "${DOCKER_HUB_TOKEN}"
      env: 
        DOCKER_HUB_USERNAME: ${{ secrets.DOCKER_HUB_USERNAME }}
        DOCKER_HUB_TOKEN: ${{ secrets.DOCKER_HUB_TOKEN }}

    - name: Copy environment file
      run: cp .env.example .env

    - name: Build the Backend Docker image
      run: docker build --tag udopigorsch/cockpit-backend:latest hyrisecockpit/api
    - name: Push Backend Docker image
      run: docker push udopigorsch/cockpit-backend:latest

    - name: Build the Generator Docker image
      run: docker build --tag udopigorsch/cockpit-generator:latest hyrisecockpit/workload_generator
    - name: Push Generator Docker image
      run: docker push udopigorsch/cockpit-generator:latest

    - name: Build the Manager Docker image
      run: docker build --tag udopigorsch/cockpit-manager:latest hyrisecockpit/database_manager
    - name: Push Manager Docker image
      run: docker push udopigorsch/cockpit-manager:latest
   
    - name: Build the Frontend Docker image
      run: docker build --tag udopigorsch/cockpit-frontend:latest hyrisecockpit/frontend
    - name: Push Frontend Docker image
      run: docker push udopigorsch/cockpit-frontend:latest
